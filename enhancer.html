<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>DS Image Enhancer | HD Upscale</title>
<style>
  :root{--bg:#0b1220;--card:#0f1b34;--txt:#e9f0ff;--muted:#a9b7d0;--btn:#2b5cff}
  *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial}
  body{margin:0;background:radial-gradient(1200px 600px at 20% 0%,#14264a 0%,#0b1220 55%,#070b14 100%);color:var(--txt)}
  header{padding:16px;border-bottom:1px solid rgba(255,255,255,.06);background:rgba(11,18,32,.85);position:sticky;top:0;z-index:10}
  header h1{margin:0;font-size:18px}
  header p{margin:6px 0 0;color:var(--muted);font-size:13px}
  .wrap{max-width:1100px;margin:0 auto;padding:16px}
  .grid{display:grid;grid-template-columns:360px 1fr;gap:14px}
  @media(max-width:980px){.grid{grid-template-columns:1fr}}
  .card{background:linear-gradient(180deg,rgba(15,27,52,.86),rgba(10,16,32,.86));
        border:1px solid rgba(255,255,255,.08);border-radius:16px;padding:14px;
        box-shadow:0 10px 30px rgba(0,0,0,.35)}
  label{display:block;font-size:12px;color:#cfe0ff;margin:10px 0 6px}
  input[type="file"], input[type="number"], select{
    width:100%;padding:10px;border-radius:12px;border:1px solid rgba(255,255,255,.1);
    background:rgba(0,0,0,.18);color:var(--txt)
  }
  input[type="range"]{width:100%}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .btn{appearance:none;border:0;background:var(--btn);color:#fff;padding:10px 12px;border-radius:12px;cursor:pointer;font-weight:650}
  .btn.secondary{background:#1b2a4a}
  .btn:disabled{opacity:.45;cursor:not-allowed}
  .hint{color:var(--muted);font-size:12px;line-height:1.4;margin-top:8px}
  .pill{display:inline-flex;gap:8px;align-items:center;padding:7px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.1);
        background:rgba(0,0,0,.18);color:#d8e6ff;font-size:12px}
  .preview{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  @media(max-width:700px){.preview{grid-template-columns:1fr}}
  .pane{border:1px solid rgba(255,255,255,.1);border-radius:14px;overflow:hidden;background:rgba(0,0,0,.18)}
  .paneHead{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;border-bottom:1px solid rgba(255,255,255,.08)}
  canvas{width:100%;height:auto;display:block}
  .check{display:flex;align-items:center;gap:8px;margin-top:10px}
  .check input{width:18px;height:18px}
</style>
</head>
<body>
<header>
  <div class="wrap">
    <h1>DS Image Enhancer — HD Upscale</h1>
    <p>Resize + Denoise + Sharpen (browser-based). “Keep Ratio” से aspect same रहेगा.</p>
  </div>
</header>

<div class="wrap">
  <div class="grid">

    <!-- Controls -->
    <div class="card">
      <label>Upload Image</label>
      <input id="file" type="file" accept="image/*">

      <div class="hint">Tip: बहुत ज़्यादा blur image में “नई detail” नहीं बनेगी, पर साफ़/HD size में output मिलेगा.</div>

      <label>Target Width (px)</label>
      <input id="w" type="number" min="50" value="1920">

      <label>Target Height (px)</label>
      <input id="h" type="number" min="50" value="1080">

      <div class="check">
        <input id="keep" type="checkbox" checked>
        <label for="keep" style="margin:0">Keep Ratio (Aspect same)</label>
      </div>

      <label>Denoise (0–3): <span id="dnVal" class="pill">1</span></label>
      <input id="denoise" type="range" min="0" max="3" value="1">

      <label>Sharpen (0–3): <span id="shVal" class="pill">2</span></label>
      <input id="sharpen" type="range" min="0" max="3" value="2">

      <label>Clarity/Contrast (0–20): <span id="ctVal" class="pill">8</span></label>
      <input id="contrast" type="range" min="0" max="20" value="8">

      <label>Export Format</label>
      <select id="fmt">
        <option value="png" selected>PNG (best quality)</option>
        <option value="jpg">JPG (smaller size)</option>
      </select>

      <div class="row" style="margin-top:12px">
        <button id="run" class="btn" disabled>Enhance + Upscale</button>
        <button id="reset" class="btn secondary" disabled>Reset</button>
        <button id="dl" class="btn" disabled>Download</button>
      </div>

      <div class="hint">
        Suggested: Denoise 1, Sharpen 2, Contrast 6–10.  
        Logos/text: Denoise 0, Sharpen 2–3.
      </div>
      <label>Unit</label>
<select onchange="unit=this.value">
  <option value="px" selected>Pixels</option>
  <option value="inch">Inch</option>
  <option value="cm">CM</option>
</select>

<label>Resolution (DPI)</label>
<input type="number" value="300" onchange="dpi=parseInt(this.value)">

    </div>
    

    <!-- Preview -->
    <div class="card">
      <div class="preview">
        <div class="pane">
          <div class="paneHead">
            <strong>Original</strong>
            <span id="info1" class="pill">—</span>
          </div>
          <canvas id="c1"></canvas>
        </div>

        <div class="pane">
          <div class="paneHead">
            <strong>Enhanced Output</strong>
            <span id="info2" class="pill">—</span>
          </div>
          <canvas id="c2"></canvas>
        </div>
      </div>
      <div class="hint" style="margin-top:10px">
        Output आपके दिए हुए size में बनेगा. Keep Ratio on हो तो height/width auto adjust हो जाएगा.
      </div>
    </div>

  </div>
</div>

<script>
const file = document.getElementById('file');
const run = document.getElementById('run');
const reset = document.getElementById('reset');
const dl = document.getElementById('dl');

const wIn = document.getElementById('w');
const hIn = document.getElementById('h');
const keep = document.getElementById('keep');

const denoise = document.getElementById('denoise');
const sharpen = document.getElementById('sharpen');
const contrast = document.getElementById('contrast');
const fmt = document.getElementById('fmt');

const c1 = document.getElementById('c1');
const c2 = document.getElementById('c2');
const ctx1 = c1.getContext('2d',{willReadFrequently:true});
const ctx2 = c2.getContext('2d',{willReadFrequently:true});

let img = new Image();
let srcData = null;
let srcW=0, srcH=0;

function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }

// ---- DPI + UNIT SYSTEM ----
let dpi = 300;
let unit = "px";

function toPixels(val){
  if(unit==="px") return val;
  if(unit==="inch") return val * dpi;
  if(unit==="cm") return (val/2.54) * dpi;
  return val;
}

function convertSize(){
  let W = parseFloat(wIn.value);
  let H = parseFloat(hIn.value);
  return {
    w: Math.round(toPixels(W)),
    h: Math.round(toPixels(H))
  };
}

// ---- Image Upload ----
file.addEventListener('change',(e)=>{
  const f=e.target.files?.[0];
  if(!f) return;
  const r=new FileReader();
  r.onload=()=>{
    img=new Image();
    img.onload=()=>{
      srcW=img.naturalWidth;
      srcH=img.naturalHeight;
      c1.width=srcW; c1.height=srcH;
      ctx1.drawImage(img,0,0);
      srcData=ctx1.getImageData(0,0,srcW,srcH);
      run.disabled=false;
      reset.disabled=false;
    };
    img.src=r.result;
  };
  r.readAsDataURL(f);
});

// ---- Better Upscale (multi-pass for sharpness) ----
function upscaleHighQuality(){
  let size = convertSize();
  let W = clamp(size.w,50,8000);
  let H = clamp(size.h,50,8000);

  if(keep.checked){
    let ratio = srcW/srcH;
    H = Math.round(W/ratio);
  }

  c2.width=W; c2.height=H;

  ctx2.imageSmoothingEnabled=true;
  ctx2.imageSmoothingQuality="high";

  // multi-pass upscale
  let tempW=srcW, tempH=srcH;
  let tempCanvas=document.createElement("canvas");
  let tctx=tempCanvas.getContext("2d");

  tempCanvas.width=srcW;
  tempCanvas.height=srcH;
  tctx.drawImage(c1,0,0);

  while(tempW < W){
    tempW = Math.min(tempW*1.5, W);
    tempH = Math.min(tempH*1.5, H);
    let newCanvas=document.createElement("canvas");
    newCanvas.width=tempW;
    newCanvas.height=tempH;
    let nctx=newCanvas.getContext("2d");
    nctx.imageSmoothingEnabled=true;
    nctx.imageSmoothingQuality="high";
    nctx.drawImage(tempCanvas,0,0,tempW,tempH);
    tempCanvas=newCanvas;
  }

  ctx2.drawImage(tempCanvas,0,0,W,H);

  let out=ctx2.getImageData(0,0,W,H);

  if(denoise.value>0) out=boxBlur(out,W,H,denoise.value);
  if(contrast.value>0) out=applyContrast(out,contrast.value);
  if(sharpen.value>0) out=unsharpMask(out,W,H,sharpen.value);

  ctx2.putImageData(out,0,0);
}

// ---- Filters ----
function boxBlur(imgData,w,h,radius){
  if(radius<=0) return imgData;
  let d=imgData.data;
  let out=new Uint8ClampedArray(d.length);

  for(let y=1;y<h-1;y++){
    for(let x=1;x<w-1;x++){
      let sumR=0,sumG=0,sumB=0,count=0;
      for(let dy=-radius;dy<=radius;dy++){
        for(let dx=-radius;dx<=radius;dx++){
          let i=((y+dy)*w+(x+dx))*4;
          sumR+=d[i];
          sumG+=d[i+1];
          sumB+=d[i+2];
          count++;
        }
      }
      let o=(y*w+x)*4;
      out[o]=sumR/count;
      out[o+1]=sumG/count;
      out[o+2]=sumB/count;
      out[o+3]=255;
    }
  }
  imgData.data.set(out);
  return imgData;
}

function applyContrast(imgData,str){
  let d=imgData.data;
  let f=1+(str/20)*0.4;
  for(let i=0;i<d.length;i+=4){
    d[i]=clamp((d[i]-128)*f+128,0,255);
    d[i+1]=clamp((d[i+1]-128)*f+128,0,255);
    d[i+2]=clamp((d[i+2]-128)*f+128,0,255);
  }
  return imgData;
}

function unsharpMask(imgData,w,h,level){
  let d=imgData.data;
  let k=[0.6,1.2,1.8,2.4][level];
  for(let i=0;i<d.length;i+=4){
    d[i]=clamp(d[i]*k,0,255);
    d[i+1]=clamp(d[i+1]*k,0,255);
    d[i+2]=clamp(d[i+2]*k,0,255);
  }
  return imgData;
}

// ---- Buttons ----
run.addEventListener('click',upscaleHighQuality);

dl.addEventListener('click',()=>{
  let a=document.createElement("a");
  a.download="ds-enhanced.png";
  a.href=c2.toDataURL("image/png");
  a.click();
});
</script>

</body>
</html>
